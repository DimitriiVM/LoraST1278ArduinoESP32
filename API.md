# LoRa API

## Include Library

```arduino
#include <LoRa.h>
```

## Setup

### Begin

Инициализируйте библиотеку с указанной частотой.

```arduino
LoRa.begin(frequency);
```
* `частота" - частота в Гц (`433E6`, `868E6`, `915E6`)

Возвращает "1` в случае успеха и "0" в случае неудачи.

### Set pins

Переопределите используемые библиотекой пин-коды `NSS`, `NRESET` и `DIO0` по умолчанию. **Должен быть вызван перед `LoRa.begin()`.

```arduino
LoRa.setPins(ss, reset, dio0);
```
 * `ss` - выберите новый подчиненный pin-код для использования, по умолчанию используется `10`
 * `reset` - новый используемый pin-код сброса, по умолчанию используется `9`
* `dio0` - используется новый вывод DIO0, значение по умолчанию "2".  **Должен быть** с возможностью прерывания через [attachInterrupt(...)](https://www.arduino.cc/en/Reference/AttachInterrupt).

Этот вызов является необязательным и должен использоваться только в том случае, если вам нужно изменить используемые по умолчанию pin-коды.

#### No MCU controlled reset pin

Чтобы сохранить дополнительные контакты, можно было бы соединить контакт сброса микроконтроллера с контактом сброса радиоприемника, таким образом, производя сброс только при запуске.

* `сброс` - установите значение "-1", чтобы исключить этот pin-код.

#### Pin dio0 interrupt callbacks

Вывод dio0 можно использовать для обратного вызова обнаружения активности канала, обратного вызова завершения передачи и/или обратного вызова приема, проверки `onCadDone`, `onTxDone` и `onReceive`.

### Set SPI interface

Переопределите интерфейс SPI по умолчанию, используемый библиотекой. **Должен быть вызван перед `LoRa.begin()`.

```arduino
LoRa.setSPI(spi);
```
* `spi` - новый интерфейс SPI для использования, по умолчанию используется "SPI".

Этот вызов является необязательным и должен использоваться только в том случае, если вам нужно изменить используемый по умолчанию SPI-интерфейс, в случае, если на вашей плате Arduino (или совместимой с ней) присутствует более одного SPI-интерфейса.

### Set SPI Frequency

Переопределите частоту SPI по умолчанию, равную 10 МГц, используемую библиотекой. **Должна быть вызвана перед `LoRa.begin()`.

```arduino
LoRa.setSPIFrequency(frequency);
```
* `частота" - новая используемая частота SPI, по умолчанию - "8E6".

Этот вызов является необязательным и используется только в том случае, если вам нужно изменить частоту SPI, используемую по умолчанию. Некоторые преобразователи логического уровня не могут поддерживать высокие скорости, такие как 8 МГц, поэтому с помощью "LoRa.setSPIFrequency(частота)" можно выбрать более низкую частоту вращения.

### End

Остановить работу библиотеки

```arduino
LoRa.end()
```

## Sending data

### Begin packet

Запустите последовательность отправки пакета.

```arduino
LoRa.beginPacket();

LoRa.beginPacket(implicitHeader);
```

* `implicitHeader` - (необязательно) `true` включает режим неявного заголовка, `false` включает режим явного заголовка (по умолчанию).

Возвращает значение "1", если радиостанция готова к передаче, и "0", если она занята или находится в состоянии сбоя.

### Writing

Запишите данные в пакет. Каждый пакет может содержать до 255 байт.

```arduino
LoRa.write(byte);

LoRa.write(buffer, length);
```
* `байт` - один байт для записи в пакет.

или

* `буфер` - данные для записи в пакет
* "длина" - размер данных для записи

Возвращает количество записанных байт.

** Примечание:** Для записи данных в пакет также можно использовать другие API печати Arduino

### End packet

Завершите последовательность отправки пакета.

```arduino
LoRa.endPacket();

LoRa.endPacket(async);
```
* `асинхронный" - (необязательно) "true" включает неблокирующий режим, "false" ожидает завершения передачи (по умолчанию).

Возвращает "1` в случае успеха и "0" в случае неудачи.

### Tx Done

**ВНИМАНИЕ**: TxDonecallback использует вывод прерывания в функции проверки `dio0` `setPins`!

### Зарегистрировать обратный вызов

Зарегистрируйте функцию обратного вызова для завершения пакетной передачи.

```arduino
LoRa.onTxDone(onTxDone);

void onTxDone() {
 // ...
}
```

* `onTxDone` - функция, вызываемая при завершении пакетной передачи.

## Получение данных

### Разбор пакета

Проверьте, был ли получен пакет.

```arduino
int packetSize = LoRa.parsePacket();

int packetSize = LoRa.parsePacket(size);
```

* `size` - (необязательно) если включен режим неявного заголовка `> 0` с ожидаемым пакетом байт `size`, режимом по умолчанию является режим явного заголовка


Возвращает размер пакета в байтах или "0", если пакет не был получен.

### Режим непрерывного приема

**ВНИМАНИЕ**: При получении обратного вызова используется вывод прерывания на `dio0`, проверьте функцию `setPins`!

#### Зарегистрировать обратный вызов

Зарегистрируйте функцию обратного вызова при получении пакета.

```arduino
LoRa.onReceive(onReceive);

void onReceive(int packetSize) {
 // ...
}
```
* `onReceive` - функция, вызываемая при получении пакета.

#### Режим приема

Переводит радиостанцию в режим непрерывного приема.

```arduino
LoRa.receive();

LoRa.receive(int size);
```

* `size` - (необязательно) если включен режим неявного заголовка `> 0` с ожидаемым пакетом байт `size`, режимом по умолчанию является режим явного заголовка

Обратный вызов onReceive будет вызван при получении пакета.

### Пакет RSSI

```arduino
int rssi = LoRa.packetRssi();
```

Возвращает усредненный RSSI последнего полученного пакета (dBm).
Чем ближе к  нулю тем сигнал мощнее!

### Пакетный SNR-сигнал

```arduino
float snr = LoRa.packetSnr();
```

Возвращает приблизительное значение SNR полученного пакета в базе данных.

## RSSI

```arduino
int rssi = LoRa.rssi();
```
Возвращает текущий RSSI радиостанции (dBm). RSSI может быть считан в любое время (как во время приема пакетов, так и без него).

### Ошибка частоты передачи пакетов

```arduino
long freqErr = LoRa.packetFrequencyError();
```

Возвращает ошибку частоты принятого пакета в Гц. Ошибка частоты - это смещение частоты между центральной частотой приемника и частотой входящего сигнала LoRa.

### Наличие байт в буфере

```arduino
int availableBytes = LoRa.available()
```

Возвращает количество байт, доступных для чтения.

### Просмотр наличия байт

Взгляните на следующий байт в пакете.

```arduino
byte b = LoRa.peek();
```

Возвращает следующий байт в пакете или `-1`, если доступных байтов нет.

### Чтение

Считайте следующий байт из пакета.

```arduino
byte b = LoRa.read();
```

Возвращает следующий байт в пакете или `-1`, если доступных байтов нет.

**Примечание:** Другие API Arduino ["Stream" API](https://www.arduino.cc/en/Reference/Stream) также могут быть использованы для чтения данных из пакета

## Обнаружение активности канала

**ВНИМАНИЕ**: Обратный вызов для обнаружения активности канала использует вывод прерывания на `dio0`, проверьте функцию `setPins`!

### Зарегистрировать обратный вызов

Зарегистрируйте функцию обратного вызова для завершения обнаружения активности канала.
```arduino
LoRa.onCadDone(onCadDone);

void onCadDone(boolean signalDetected) {
  // ...
}
```
 * `onCadDone` - функция, вызываемая при обнаружении активности канала.
 * `signalDetected` - если значение "true", радиостанция обнаруживает наличие других сигналов LoRa.

### Режим обнаружения активности канала
Переводит радиоприемник в режим обнаружения активности канала.
```arduino
LoRa.channelActivityDetection();
```
## Другие режимы радиосвязи

### Idle режим

Переведите радиоприемник в режим ожидания.

```arduino
LoRa.idle();
```

### Спящий режим

Переведите радио в спящий режим.

```arduino
LoRa.sleep();
```

## Параметры радиосвязи

### TX Power

Измените мощность передачи радиоприемника.

```arduino
LoRa.setTxPower(txPower);

LoRa.setTxPower(txPower, outputPin);
```
* `txPower" - мощность передачи в дБ, по умолчанию равна `17`
 * "outputPin" - (необязательно) Выходной вывод PA, поддерживаемые значения - `PA_OUTPUT_RFO_PIN` и `PA_OUTPUT_PA_BOOST_PIN`, по умолчанию - `PA_OUTPUT_PA_BOOST_PIN`.

Поддерживаемые значения - от `2` до `20` для `PA_OUTPUT_PA_BOOST_PIN` и от `0` до `14` для `PA_OUTPUT_RFO_PIN`.

У большинства модулей выходной вывод PA подключен к усилителю PA,

### Frequency

Измените частоту радиоприемника.

```arduino
LoRa.setFrequency(frequency);
```
* `частота" - частота в Гц (`433E6`, `868E6`, `915E6`)

### Коэффициент растекания

Измените коэффициент распространения радиосигнала.

```arduino
LoRa.setSpreadingFactor(spreadingFactor);
```
* `spreadingFactor` - коэффициент распространения, по умолчанию равен "7".

Поддерживаемые значения находятся в диапазоне от "6" до "12". Если установлен коэффициент расширения, равный "6", для передачи и приема пакетов должен использоваться режим неявного заголовка.

### Полоса пропускания сигнала

Измените полосу пропускания сигнала радиостанции.

```arduino
LoRa.setSignalBandwidth(signalBandwidth);
```

* `Ширина полосы сигнала` - полоса пропускания сигнала в Гц, по умолчанию равна `125E3`.

Поддерживаемыми значениями являются `7.8E3`, `10.4E3`, `15.6E3`, `20.8E3`, `31.25E3`, `41.7E3`, `62.5E3`, `125E3`, `250E3` и `500E3`.

### Скорость кодирования

Измените скорость кодирования радиостанции.

```arduino
LoRa.setCodingRate4(codingRateDenominator);
```

* `codingRateDenominator` - знаменатель скорости кодирования, по умолчанию равен "5".

Поддерживаемые значения находятся в диапазоне от "5" до "8", они соответствуют скорости кодирования "4/5" и "4/8". Числитель скорости кодирования фиксирован на `4`.

### Длина преамбулы

Измените длину преамбулы радиоприемника.

```arduino
LoRa.setPreambleLength(preambleLength);
```

* `preambleLength` - длина преамбулы в символах, по умолчанию равна "8".

Поддерживаемые значения находятся в диапазоне от "6" до "65535`.

### Синхронизирующее слово

Измените синхронизирующее слово радиоприемника.

```arduino
LoRa.setSyncWord(syncWord);
```

* `syncWord` - значение в байтах, используемое в качестве слова синхронизации, по умолчанию равно `0x12`.

### CRC

Включите или отключите использование CRC, по умолчанию CRC не используется.

```arduino
LoRa.enableCrc();

LoRa.disableCrc();
```

### Инвертировать сигналы IQ

Включение или выключение инвертирования сигналов Lorax I и Q, по умолчанию функция инвертирования не используется.

```arduino
LoRa.enableInvertIQ();

LoRa.disableInvertIQ();
```
### Усиление LNA

Установите усиление LNA для повышения чувствительности приемопередатчика, по умолчанию используется AGC (автоматическая регулировка усиления), а усиление LNA не используется.

```arduino
LoRa.setGain(gain);
```

 * `gain` - LNA gain
Поддерживаемые значения находятся в диапазоне от "0" до "6". Если коэффициент усиления равен 0, то AGC будет включен, а коэффициент усиления LNA использоваться не будет. В противном случае, если коэффициент усиления от 1 до 6, AGC будет отключен и будет использоваться коэффициент усиления LNA.

## Другие функции

### Random

Сгенерируйте случайный байт на основе широкополосного измерения RSSI.

```
byte b = LoRa.random();
```

Возвращает случайный байт.
